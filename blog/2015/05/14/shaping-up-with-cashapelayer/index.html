
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Shaping Up With CAShapeLayer - YMediaLabs Engineering Blog</title>
  <meta name="author" content="YMediaLabs">

  
  <meta name="description" content="What out stands iOS mobile platform from others is the power of animations. For animations iOS provides several classes with animatable properties &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ymedialabs.github.io/blog/2015/05/14/shaping-up-with-cashapelayer/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="YMediaLabs Engineering Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">YMediaLabs Engineering Blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="ymedialabs.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Shaping Up With CAShapeLayer</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-14T12:19:13+05:30'><span class='date'><span class='date-month'>May</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:19 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>What out stands iOS mobile platform from others is the power of animations. For animations iOS provides several classes with animatable properties that makes animations look easier. However some animations like the <em>Apple&rsquo;s application circular loader</em>, there are no special classes that readily available for animation.</p>

<p>This can be made possible with a special class <strong>CAShapeLayer</strong>. CAShapeLayer shapes itself to the path provided to it through the <em>path</em> property. The <em>path</em> property is a <em>CGPath</em> instance. We can use UIBezierPath API&rsquo;s to get the required shape and retrive the CGPaths.</p>

<p>Lets get started to design out custom <strong>Apple application circular loader</strong> using key frame animations</p>

<p><strong>Create a CAShapeLayer</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">animatinglayer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAShapeLayer</span> <span class="n">layer</span><span class="p">];</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">animatingLayer</span><span class="p">.</span><span class="n">strokeColor</span> <span class="o">=</span> <span class="o">&lt;</span><span class="err">#</span><span class="n">stroke</span> <span class="n">color</span><span class="err">#</span><span class="o">&gt;</span><span class="p">;</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">animatingLayer</span><span class="p">.</span><span class="n">fillColor</span> <span class="o">=</span> <span class="o">&lt;</span><span class="err">#</span><span class="n">fill</span> <span class="n">color</span><span class="err">#</span><span class="o">&gt;</span><span class="p">;</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">animatingLayer</span><span class="p">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="o">&lt;</span><span class="err">#</span><span class="n">line</span> <span class="n">width</span><span class="err">#</span><span class="o">&gt;</span><span class="p">;</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">animatingLayer</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">layer</span> <span class="nl">addSublayer</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">animatingLayer</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Create a Initial BezierPath and assign it to the above layer above</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">UIBezierPath</span> <span class="o">*</span><span class="n">initialPath</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIBezierPath</span> <span class="n">bezierPath</span><span class="p">];</span> <span class="c1">//empty path</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// get the radius of the inner path</span>
</span><span class='line'><span class="n">CGFloat</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">MIN</span><span class="p">(</span><span class="n">CGRectGetWidth</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">),</span> <span class="n">CGRectGetHeight</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// add the arc</span>
</span><span class='line'><span class="p">[</span><span class="n">initialPath</span> <span class="nl">addArcWithCenter</span><span class="p">:</span><span class="n">center</span> <span class="nl">radius</span><span class="p">:</span><span class="n">radius</span> <span class="nl">startAngle</span><span class="p">:</span><span class="n">degreeToRadian</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span> <span class="nl">endAngle</span><span class="p">:</span><span class="n">degreeToRadian</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">)</span> <span class="nl">clockwise</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// set the path</span>
</span><span class='line'><span class="nb">self</span><span class="p">.</span><span class="n">animatinglayer</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">initialPath</span><span class="p">.</span><span class="bp">CGPath</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>once we have the shape and the initial path all we need are the array of paths for key frame animation</p>

<p><strong>Create a Initial BezierPath and assign it to the above layer above</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nf">keyframePathsWithDuration:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">duration</span> <span class="nf">lastUpdatedAngle:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">lastUpdatedAngle</span> <span class="nf">newAngle:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">newAngle</span> <span class="nf">radius:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">radius</span> <span class="nf">type:</span><span class="p">(</span><span class="n">RMIndicatorType</span><span class="p">)</span><span class="nv">type</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="bp">NSUInteger</span> <span class="n">frameCount</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">duration</span> <span class="o">*</span> <span class="mi">60</span><span class="p">);</span>
</span><span class='line'>    <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="nl">arrayWithCapacity</span><span class="p">:</span><span class="n">frameCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">frame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">frame</span> <span class="o">&lt;=</span> <span class="n">frameCount</span><span class="p">;</span> <span class="n">frame</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">CGFloat</span> <span class="n">startAngle</span> <span class="o">=</span> <span class="n">degreeToRadian</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">);</span>
</span><span class='line'>        <span class="n">CGFloat</span> <span class="n">endAngle</span> <span class="o">=</span> <span class="n">lastUpdatedAngle</span> <span class="o">+</span> <span class="p">(((</span><span class="n">newAngle</span> <span class="o">-</span> <span class="n">lastUpdatedAngle</span><span class="p">)</span> <span class="o">*</span> <span class="n">frame</span><span class="p">)</span> <span class="o">/</span> <span class="n">frameCount</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">[</span><span class="n">array</span> <span class="nl">addObject</span><span class="p">:(</span><span class="kt">id</span><span class="p">)([</span><span class="nb">self</span> <span class="nl">pathWithStartAngle</span><span class="p">:</span><span class="n">startAngle</span> <span class="nl">endAngle</span><span class="p">:</span><span class="n">endAngle</span> <span class="nl">radius</span><span class="p">:</span><span class="n">radius</span> <span class="nl">type</span><span class="p">:</span><span class="n">type</span><span class="p">].</span><span class="bp">CGPath</span><span class="p">)];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="bp">NSArray</span> <span class="nl">arrayWithArray</span><span class="p">:</span><span class="n">array</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Method to return the bezier path with required start end angle and radius </span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">UIBezierPath</span> <span class="o">*</span><span class="p">)</span><span class="nf">pathWithStartAngle:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">startAngle</span> <span class="nf">endAngle:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">endAngle</span> <span class="nf">radius:</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nv">radius</span> <span class="nf">type:</span><span class="p">(</span><span class="n">RMIndicatorType</span><span class="p">)</span><span class="nv">type</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">BOOL</span> <span class="n">clockwise</span> <span class="o">=</span> <span class="n">startAngle</span> <span class="o">&lt;</span> <span class="n">endAngle</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">UIBezierPath</span> <span class="o">*</span><span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIBezierPath</span> <span class="n">bezierPath</span><span class="p">];</span>
</span><span class='line'>    <span class="bp">CGPoint</span> <span class="n">center</span> <span class="o">=</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">kRMClosedIndicator</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">path</span> <span class="nl">addArcWithCenter</span><span class="p">:</span><span class="n">center</span> <span class="nl">radius</span><span class="p">:</span><span class="n">radius</span> <span class="nl">startAngle</span><span class="p">:</span><span class="n">startAngle</span> <span class="nl">endAngle</span><span class="p">:</span><span class="n">endAngle</span> <span class="nl">clockwise</span><span class="p">:</span><span class="n">clockwise</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">path</span> <span class="nl">moveToPoint</span><span class="p">:</span><span class="n">center</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">path</span> <span class="nl">addArcWithCenter</span><span class="p">:</span><span class="n">center</span> <span class="nl">radius</span><span class="p">:</span><span class="n">radius</span> <span class="nl">startAngle</span><span class="p">:</span><span class="n">startAngle</span> <span class="nl">endAngle</span><span class="p">:</span><span class="n">endAngle</span> <span class="nl">clockwise</span><span class="p">:</span><span class="n">clockwise</span><span class="p">];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">path</span> <span class="n">closePath</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">path</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Function to convert degree to radians</span>
</span><span class='line'><span class="kt">float</span> <span class="nf">degreeToRadian</span><span class="p">(</span><span class="kt">float</span> <span class="n">degree</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">((</span><span class="n">degree</span> <span class="o">*</span> <span class="n">M_PI</span><span class="p">)</span><span class="o">/</span><span class="mf">180.0f</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>once we have the array of paths, we can perform the animation</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'> <span class="bp">CAKeyframeAnimation</span> <span class="o">*</span><span class="n">pathAnimation</span> <span class="o">=</span> <span class="p">[</span><span class="bp">CAKeyframeAnimation</span> <span class="nl">animationWithKeyPath</span><span class="p">:</span><span class="s">@&quot;path&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">pathAnimation</span> <span class="nl">setValues</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">paths</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">pathAnimation</span> <span class="nl">setDuration</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">animationDuration</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">pathAnimation</span> <span class="nl">setTimingFunction</span><span class="p">:[</span><span class="bp">CAMediaTimingFunction</span> <span class="nl">functionWithName</span><span class="p">:</span><span class="n">kCAMediaTimingFunctionEaseOut</span><span class="p">]];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">pathAnimation</span> <span class="nl">setRemovedOnCompletion</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">animatingLayer</span> <span class="nl">addAnimation</span><span class="p">:</span><span class="n">pathAnimation</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;path&quot;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>ta-da that is all need to create Apple&rsquo;s loader animation. The complete source code is available <a href="https://github.com/MaheshRS/Download-Indicator">here on github</a>.</p>

<p><img src="/images/posts/2015-05-14/RMDownload_Indicator.gif" title="&#34;Animation Gif&#34;" alt="&#34;Animation Gif&#34;"></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Mahesh Shanbhag</span></span>

      




<time class='entry-date' datetime='2015-05-14T12:19:13+05:30'><span class='date'><span class='date-month'>May</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:19 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ios/'>ios</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://ymedialabs.github.io/blog/2015/05/14/shaping-up-with-cashapelayer/" data-via="ymedialabs" data-counturl="http://ymedialabs.github.io/blog/2015/05/14/shaping-up-with-cashapelayer/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/05/12/draw-a-bezier-curve-through-a-set-of-2d-points-in-ios/" title="Previous Post: Draw a Bezier Curve through a set of 2D Points in iOS">&laquo; Draw a Bezier Curve through a set of 2D Points in iOS</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/05/25/possible-abuse-of-dispatch-after/" title="Next Post: Possible abuse of dispatch_after">Possible abuse of dispatch_after &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/03/communication-in-apple-watchos-2/">Communication Between Apple Watch With New WatchOS-2 and iPhone</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/30/apple-watch-connectivity/">How Do We Communicate Between Watch and iPhone App ?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/19/symbolicating-crashes-now-made-easy/">Symbolicating Crashes Now Made Easy</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/25/possible-abuse-of-dispatch-after/">Possible Abuse of Dispatch_after</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/14/shaping-up-with-cashapelayer/">Shaping Up With CAShapeLayer</a>
      </li>
    
  </ul>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - YMediaLabs -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
